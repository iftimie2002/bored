<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Are you Smart, or just Confident?</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; overflow-x: hidden; }
    body { background: linear-gradient(135deg, #eef2ff 0%, #fce7f3 100%); }
    #app { min-height: 100vh; display: flex; flex-direction: column; }
    .container { flex: 1; padding: env(safe-area-inset-top, 20px) env(safe-area-inset-right, 16px) env(safe-area-inset-bottom, 20px) env(safe-area-inset-left, 16px); }
    .card { border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
    .timer-ring { transition: stroke-dashoffset 0.3s ease; }
    .btn-touch { min-height: 64px; }
    .option-btn { min-height: 72px; }
  </style>
</head>
<body class="font-sans antialiased">
  <div id="app" class="flex flex-col h-screen bg-gradient-to-br from-indigo-50 via-white to-pink-50"></div>

<script>
(function(){
  const trueFalseQuestions = [ /* ← all your 20 TF questions (same as before) */ 
    {type:"tf", q:'A cloud weighs around a million tons.', correct:true},
    {type:"tf", q:'Giraffes are 30x more likely to be struck by lightning than humans.', correct:true},
    {type:"tf", q:'Identical twins have identical fingerprints.', correct:false},
    {type:"tf", q:"The Earth's rotation is speeding up.", correct:false},
    {type:"tf", q:'Your brain literally eats itself every day.', correct:true},
    {type:"tf", q:'Mars is shaped more like a rugby ball than a sphere.', correct:true},
    {type:"tf", q:"The universe's average colour is officially called Cosmic Latte.", correct:true},
    {type:"tf", q:'Water itself is not wet — only objects touching it are.', correct:true},
    {type:"tf", q:'A chicken once lived for 18 months without its head.', correct:true},
    {type:"tf", q:'There are more bacterial cells in your body than human cells.', correct:true},
    {type:"tf", q:"Octopuses don't have tentacles — only arms.", correct:true},
    {type:"tf", q:'Most maps you see in school are actually wrong.', correct:true},
    {type:"tf", q:'Snails can have over 10,000 teeth.', correct:true},
    {type:"tf", q:'Lightning is hotter than the surface of the Sun.', correct:true},
    {type:"tf", q:'Bananas are slightly radioactive.', correct:true},
    {type:"tf", q:'You travel millions of kilometres every day without realising it.', correct:true},
    {type:"tf", q:'You can fold a piece of A4 paper more than eight times.', correct:false},
    {type:"tf", q:'A penguin has been recorded diving deeper than 500 metres.', correct:true},
    {type:"tf", q:'There is a planet made mostly of diamond.', correct:true},
    {type:"tf", q:'The Moon is growing larger every year.', correct:false}
  ];

  const mcQuestions = [ /* ← all your 20 MC questions (same as before) */ 
    {type:"mc", q:"What are the prime factors of 24?", options:["Two and three","Two and four","Three and eight","Two and twelve"], correct:0},
    {type:"mc", q:"How many sides does a trapezoid have?", options:["Three","Four","Five","Six"], correct:1},
    {type:"mc", q:"Which math theorem states that in a right triangle, A² + B² = C²?", options:["Euclid's Theorem","Pythagorean Theorem","Fermat's Last Theorem","Pascal's Theorem"], correct:1},
    {type:"mc", q:"How many degrees are in a circle?", options:["180","270","360","365"], correct:2},
    {type:"mc", q:"How many yards are in a mile?", options:["1000","1760","2000","5280"], correct:1},
    {type:"mc", q:"What produces the majority of the breathable air on earth?", options:["Trees","Grass","The oceans","Algae in rainforests"], correct:2},
    {type:"mc", q:"Which travels faster: Sound or light?", options:["Sound","Light","Same speed","Depends"], correct:1},
    {type:"mc", q:"What mineral can you add to water to make things float easier?", options:["Sugar","Salt","Iron","Baking soda"], correct:1},
    {type:"mc", q:"Roughly how many mph does Earth spin at the equator?", options:["500","1000","1500","2000"], correct:1},
    {type:"mc", q:"How many elements are on the periodic table?", options:["92","108","118","124"], correct:2},
    {type:"mc", q:"Which blood type is the universal donor?", options:["AB+","A-","O-","B+"], correct:2},
    {type:"mc", q:"How many moons does Neptune have?", options:["8","14","27","63"], correct:1},
    {type:"mc", q:"Which disease was eradicated in 1980?", options:["Polio","Measles","Smallpox","Malaria"], correct:2},
    {type:"mc", q:"Who was the first American woman in space?", options:["Valentina Tereshkova","Mae Jemison","Sally Ride","Judith Resnik"], correct:2},
    {type:"mc", q:"How many pounds in a US ton?", options:["1000","2000","2204","2240"], correct:1},
    {type:"mc", q:"Largest bone in the human body?", options:["Tibia","Femur","Humerus","Spine"], correct:1},
    {type:"mc", q:"How many planets in the solar system?", options:["7","8","9","10"], correct:1},
    {type:"mc", q:"How many colors in a rainbow?", options:["6","7","8","Indefinite"], correct:1},
    {type:"mc", q:"Which astronomer is named in “Bohemian Rhapsody”?", options:["Copernicus","Kepler","Galileo","Newton"], correct:2},
    {type:"mc", q:"Fear of flowers is called?", options:["Floraphobia","Anthophobia","Botanophobia","Petalphobia"], correct:1}
  ];

  const starQuestions = [ /* ← all 17 STAR questions you gave me */ 
    {id:"s1", text:"What's the one thing in the Algarve that genuinely surprised you in a good way?", tag:"experienced"},
    {id:"s2", text:"What part of your stay felt unnecessarily difficult or annoying?", tag:"experienced"},
    {id:"s3", text:"If you could import one thing from back home to make your time here easier, what would it be?", tag:"all"},
    {id:"s4", text:"What service or product do you wish had been available here?", tag:"experienced"},
    {id:"s5", text:"What did you try to do in the Algarve that ended up being harder than expected?", tag:"experienced"},
    {id:"s6", text:"What’s something you looked for but couldn’t find easily?", tag:"experienced"},
    {id:"s7", text:"What daily task would you pay someone to handle for you while staying here?", tag:"all"},
    {id:"s8", text:"What’s one thing that would have saved you time during your trip?", tag:"experienced"},
    {id:"s9", text:"What place or service felt outdated or in need of improvement?", tag:"experienced"},
    {id:"s10", text:"What’s something from home you kept thinking “I wish they had this here”?", tag:"all"},
    {id:"s11", text:"What activity or experience did you expect to exist but didn’t?", tag:"experienced"},
    {id:"s12", text:"What moment made you think “this could be done in a better way”?", tag:"experienced"},
    {id:"s13", text:"What did you spend too much effort trying to figure out or organize?", tag:"experienced"},
    {id:"s14", text:"What local service disappointed you the most?", tag:"experienced"},
    {id:"s15", text:"What would have made your stay more comfortable on a daily basis?", tag:"experienced"},
    {id:"s16", text:"What’s something you felt was overpriced for the value?", tag:"experienced"},
    {id:"s17", text:"If you could bring one thing from back home to make your stay easier, what would it be?", tag:"all"}
  ];

  let answers = {}, sequence = [], pointer = 0, timer = null, timeLeft = 30;
  const clientId = localStorage.getItem('cid') || 'c'+Date.now();
  localStorage.setItem('cid', clientId);
  const app = document.getElementById('app');

  function esc(t) { return t.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
  function shuffle(a) { return a.sort(() => Math.random()-0.5); }

  function renderMeta() {
    app.innerHTML = `
      <div class="container flex flex-col justify-center items-center text-center px-6">
        <div class="bg-white/95 card w-full max-w-lg p-10 rounded-3xl">
          <h1 class="text-4xl font-black text-slate-800 mb-8">Are you Smart,<br>or just Confident?</h1>
          <div class="space-y-10">
            <div>
              <label class="block text-xl font-semibold mb-4">Staying in Algarve?</label>
              <select id="stay" class="w-full p-5 rounded-2xl border-2 border-slate-200 text-lg">
                <option value="leaving">Leaving soon</option>
                <option value="few">Few more days</option>
                <option value="just">Just arrived</option>
                <option value="not">Not here</option>
              </select>
            </div>
            <div>
              <label class="block text-xl font-semibold mb-4">Uber ride length?</label>
              <input id="mins" type="range" min="1" max="60" value="10" class="w-full h-3 rounded-full">
              <div class="text-5xl font-bold mt-4"><span id="minsVal">10</span> min</div>
            </div>
            <button id="start" class="w-full py-6 bg-indigo-600 text-white text-2xl font-bold rounded-2xl shadow-xl">Start Survey</button>
          </div>
        </div>
      </div>`;
    document.getElementById('mins').oninput = e => document.getElementById('minsVal').textContent = e.target.value;
    document.getElementById('start').onclick = startSurvey;
  }

  function startSurvey() {
    const mins = +document.getElementById('mins').value;
    const stay = document.getElementById('stay').value;
    const maxF = mins < 5 ? 5 : mins < 15 ? 10 : 16;
    const maxS = mins < 5 ? 2 : mins < 15 ? 5 : 8;

    const stars = shuffle(starQuestions.filter(q => q.tag === 'all' || (q.tag === 'experienced' && stay !== 'just'))).slice(0, maxS);
    const facts = shuffle([...trueFalseQuestions.map(f=>({...f,isTF:true})), ...mcQuestions.map(f=>({...f,isTF:false}))]).slice(0, maxF);

    sequence = [];
    let streak = 0, si = 0;
    facts.forEach(f => {
      sequence.push({type:'fact', q:f.q, options:f.options||null, correct:f.correct, isTF:f.isTF});
      streak++;
      if ((streak >= 2 && Math.random()<0.7) || streak >= 3) {
        if (si < stars.length) { sequence.push({type:'star', id:stars[si].id, text:stars[si++].text}); streak = 0; }
      }
    });
    while (si < stars.length) sequence.push({type:'star', id:stars[si].id, text:stars[si++].text});

    pointer = 0;
    renderQuestion();
  }

  function startTimer() {
    timeLeft = 30;
    updateTimer();
    clearInterval(timer);
    timer = setInterval(() => {
      timeLeft--;
      updateTimer();
      if (timeLeft <= 0) { clearInterval(timer); answers[sequence[pointer].q] = {answer:null, confidence:0, timedOut:true}; next(); }
    }, 1000);
  }

  function updateTimer() {
    const ring = document.getElementById('ring');
    const num = document.getElementById('time');
    if (!ring || !num) return;
    const c = 1356; // 2π×216
    ring.style.strokeDashoffset = c - (timeLeft/30)*c;
    num.textContent = timeLeft;
    ring.style.stroke = timeLeft > 10 ? '#10b981' : timeLeft > 5 ? '#f59e0b' : '#ef4444';
  }

  function renderQuestion() {
    const q = sequence[pointer];
    const progress = Math.round((pointer/sequence.length)*100);
    app.innerHTML = `
      <div class="container flex flex-col h-screen">
        <div class="flex justify-between items-center py-4 px-6">
          <button id="back" class="text-3xl">←</button>
          <div class="text-lg font-bold">${pointer+1}/${sequence.length}</div>
          <div class="w-32 h-2 bg-gray-200 rounded-full overflow-hidden"><div class="h-full bg-indigo-600 transition-all" style="width:${progress}%"></div></div>
        </div>
        <div class="flex-1 flex flex-col justify-center px-6">
          ${q.type === 'fact' ? `
            <div class="text-center mb-10">
              <svg width="120" height="120" viewBox="0 0 480 480" class="mx-auto mb-8">
                <circle cx="240" cy="240" r="216" stroke="#e5e7eb" stroke-width="36" fill="none"/>
                <circle id="ring" cx="240" cy="240" r="216" stroke="#10b981" stroke-width="36" fill="none" stroke-dasharray="1356" class="timer-ring"/>
                <text id="time" x="240" y="280" font-size="140" text-anchor="middle" font-weight="bold" fill="#1f2937">30</text>
              </svg>
              <h2 class="text-3xl font-black leading-tight px-4">${esc(q.q)}</h2>
            </div>
            <div class="space-y-5">
              ${q.isTF ? `
                <button class="true w-full py-8 btn-touch bg-gradient-to-r from-green-500 to-emerald-600 text-white text-3xl font-bold rounded-3xl shadow-xl">TRUE</button>
                <button class="false w-full py-8 btn-touch bg-gradient-to-r from-red-500 to-rose-600 text-white text-3xl font-bold rounded-3xl shadow-xl">FALSE</button>
              ` : q.options.map((o,i) => `
                <button data-i="${i}" class="option-btn w-full py-8 text-2xl font-medium bg-white border-4 border-gray-200 rounded-3xl shadow-lg hover:border-indigo-500">${esc(o)}</button>
              `).join('')}
            </div>
          ` : `
            <div class="space-y-6">
              <h2 class="text-3xl font-black leading-tight">${esc(q.text)}</h2>
              <textarea id="txt" class="w-full p-6 text-xl rounded-3xl border-4 border-gray-200 focus:border-indigo-500 outline-none resize-none" rows="5" placeholder="Your answer...">${answers[q.id]?.answer||''}</textarea>
              <button id="nextStar" class="w-full py-6 bg-indigo-600 text-white text-2xl font-bold rounded-3xl shadow-xl">Next</button>
            </div>
          `}
        </div>
      </div>`;

    if (q.type === 'fact') startTimer();

    if (q.type === 'fact' && q.isTF) {
      document.querySelector('.true').onclick = () => choose(true);
      document.querySelector('.false').onclick = () => choose(false);
    }
    if (q.type === 'fact' && !q.isTF) {
      document.querySelectorAll('.option-btn').forEach(b => b.onclick = () => {
        document.querySelectorAll('.option-btn').forEach(x => x.classList.remove('border-indigo-500','bg-indigo-50'));
        b.classList.add('border-indigo-500','bg-indigo-50');
        choose(+b.dataset.i);
      });
    }
    if (q.type === 'star') {
      document.getElementById('nextStar').onclick = () => {
        answers[q.id] = {answer: document.getElementById('txt').value.trim()};
        next();
      };
    }

    document.getElementById('back')?.addEventListener('click', () => { if(pointer>0){ clearInterval(timer); pointer--; renderQuestion(); } });
  }

  function choose(val) {
    clearInterval(timer);
    answers[sequence[pointer].q] = {answer: val};
    renderConfidence();
  }

  function renderConfidence() {
    app.innerHTML = `
      <div class="container flex flex-col justify-center items-center h-screen px-6">
        <div class="bg-white/95 card w-full max-w-lg p-10 rounded-3xl text-center">
          <h2 class="text-4xl font-black mb-12">How confident are you?</h2>
          <input id="slider" type="range" min="0" max="100" value="70" class="w-full h-12 rounded-full">
          <div class="text-8xl font-black text-indigo-600 my-10" id="val">70%</div>
          <button id="go" class="w-full py-6 bg-indigo-600 text-white text-3xl font-bold rounded-3xl shadow-xl">Continue</button>
        </div>
      </div>`;
    const s = document.getElementById('slider');
    const v = document.getElementById('val');
    s.oninput = () => v.textContent = s.value + '%';
    document.getElementById('go').onclick = () => {
      answers[sequence[pointer].q].confidence = +s.value;
      next();
    };
  }

  function next() {
    pointer++;
    if (pointer >= sequence.length) finish();
    else renderQuestion();
  }

  function finish() {
    clearInterval(timer);
    const facts = sequence.filter(x => x.type === 'fact');
    let correct = 0, confSum = 0, recap = '';
    facts.forEach(f => {
      const a = answers[f.q] || {answer:null, confidence:0};
      if (a.answer === f.correct) correct++;
      confSum += a.confidence || 0;
      const user = a.answer === null ? 'Timed out' : f.isTF ? (a.answer?'True':'False') : f.options[a.answer];
      const corr = f.isTF ? (f.correct?'True':'False') : f.options[f.correct];
      recap += `<div class="p-5 bg-white/80 rounded-2xl mb-4"><strong class="block mb-2">${esc(f.q)}</strong><div>You: ${user} | Correct: ${corr}</div></div>`;
    });
    const smart = Math.round(correct/facts.length*100);
    const conf = Math.round(confSum/facts.length);

    app.innerHTML = `
      <div class="container flex flex-col h-screen px-6 pt-10 overflow-y-auto">
        <h1 class="text-5xl font-black text-center mb-10">Results</h1>
        <div class="grid grid-cols-2 gap-6 mb-10">
          <div class="bg-indigo-100 p-8 rounded-3xl text-center"><div class="text-2xl font-bold">Smart</div><div class="text-7xl font-black text-indigo-700">${smart}</div></div>
          <div class="bg-pink-100 p-8 rounded-3xl text-center"><div class="text-2xl font-bold">Confidence</div><div class="text-7xl font-black text-pink-700">${conf}</div></div>
        </div>
        <div class="space-y-4 mb-10">${recap}</div>
        <button onclick="location.reload()" class="w-full py-6 bg-indigo-600 text-white text-2xl font-bold rounded-3xl shadow-xl">Retake Survey</button>
      </div>`;
  }

  renderMeta();
})();
</script>
</body>
</html>
